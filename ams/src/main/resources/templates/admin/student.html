<!DOCTYPE html>
<html
  class="loading"
  lang="en"
  data-textdirection="ltr"
  xmlns:th="http://www.thymeleaf.org"
>
  <head>
    <meta charset="UTF-8" />
    <title>Attendance Management System</title>
    <link href="assets/img/favicon.png" rel="icon" />
    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />

    <link
      href="assets/vendor/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="assets/vendor/bootstrap-icons/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet" />
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet" />
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet" />
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet" />

    <link href="assets/css/style.css" rel="stylesheet" />

    <script>
      function preventBack() {
        window.history.forward();
      }

      setTimeout("preventBack()", 0);

      window.onunload = function () {
        null;
      };
    </script>
  </head>

  <body>
    <div th:replace="~{admin/nav :: body}"></div>
    <main id="main" class="main">
      <div class="pagetitle">
        <h1>Student</h1>
        <nav>
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
            <li class="breadcrumb-item active">Student</li>
          </ol>
        </nav>
      </div>

      <section class="student section">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <h5
                  class="card-title"
                  data-bs-toggle="modal"
                  data-bs-target="#addStudentmodel"
                  style="cursor: pointer"
                >
                  Add Student
                </h5>
              </div>
            </div>
          </div>
          <div class="card" style="display: none">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <table class="table-custom">
                  <thead>
                    <tr>
                      <th scope="col">Student ID</th>
                      <th scope="col">Name</th>
                      <th scope="col">Email</th>
                      <th scope="col">Contact No</th>
                      <th scope="col">Faculty</th>
                      <th scope="col">Department</th>
                      <th scope="col">Program</th>
                      <th scope="col">Semester</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="addmission : ${addmissions}">
                      <td
                        th:text="${addmission.entrollmentno}"
                        style="display: none"
                      ></td>
                      <td
                        th:text="${addmission.fname} + ' ' + ${addmission.mname} + ' ' + ${addmission.lname}"
                      ></td>
                      <td th:text="${addmission.email}"></td>
                      <td th:text="${addmission.contactnumber}"></td>

                      <td
                        th:text="${addmission.facultyid.faculty}"
                        th:attr="data-facultyid=${addmission.facultyid.facultyid}"
                      ></td>

                      <td
                        th:text="${addmission.departmentid.department}"
                        th:attr="data-departmentid=${addmission.departmentid.departmentid}"
                      ></td>

                      <td
                        th:text="${addmission.programid.program}"
                        th:attr="data-programid=${addmission.programid.programid}"
                      ></td>

                      <td
                        th:text="${addmission.semesterid.semester}"
                        th:attr="data-semesterid=${addmission.semesterid.semesterid}"
                      ></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center">
                <table class="table-custom">
                  <thead>
                    <tr>
                      <th scope="col">Name</th>
                      <th scope="col">Email</th>
                      <th scope="col">Contact No</th>
                      <th scope="col">Faculty</th>
                      <th scope="col">Department</th>
                      <th scope="col">Program</th>
                      <th scope="col">Semester</th>
                      <th scope="col">Active</th>
                      <th scope="col" style="width: 100px"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr th:each="student : ${students}">
                      <td
                        th:text="${student.entrollmentno}"
                        style="display: none"
                      ></td>
                      <td
                        th:text="${student.fname} + ' ' + ${student.mname} + ' ' + ${student.lname}"
                      ></td>
                      <td th:text="${student.gvpemail}"></td>
                      <td th:text="${student.contactnumber}"></td>

                      <td
                        th:text="${student.faculty.faculty}"
                        th:attr="data-facultyid=${student.faculty.facultyid}"
                      ></td>

                      <td
                        th:text="${student.department.department}"
                        th:attr="data-departmentid=${student.department.departmentid}"
                      ></td>

                      <td
                        th:text="${student.program.program}"
                        th:attr="data-programid=${student.program.programid}"
                      ></td>

                      <td
                        th:text="${student.semester.semester}"
                        th:attr="data-semesterid=${student.semester.semesterid}"
                      ></td>

                      <td>
                        <span
                          class="badge badge-success"
                          th:if="${student.active}"
                          >YES</span
                        >
                        <span
                          class="badge badge-danger"
                          th:unless="${student.active}"
                          >NO</span
                        >
                      </td>

                      <td>
                        <i
                          class="fas fa-edit"
                          data-bs-toggle="modal"
                          th:data-studentid="${student.studentid}"
                          data-bs-target="#editstudentModal"
                        ></i>
                        <i
                          class="fas fa-trash-alt"
                          data-bs-toggle="modal"
                          th:data-studentid="${student.studentid}"
                          data-bs-target="#deletestudentModal"
                        ></i>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div class="modal fade" id="addStudentmodel" tabindex="-1">
      <div class="modal-dialog modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add Student</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <i class="fa fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-container">
              <form
                id="studentForm"
                th:action="@{/addStudent}"
                method="post"
                onsubmit="return validateForm('add')"
              >
                <div class="form-group">
                  <label for="entrollmentno" class="col-md-12 mb-3"
                    ><i class="fa fa-fax"></i> Enrollment No</label
                  >
                  <input type="text" id="entrollmentno" name="entrollmentno" />
                  <p id="entrollmentnoError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="name" class="col-md-12 mb-3"
                    ><i class="fas fa-user"></i> Name</label
                  >
                  <input
                    type="text"
                    placeholder="First Name"
                    id="fname"
                    name="fname"
                    style="width: 32.5%; display: inline-block"
                  />
                  <input
                    type="text"
                    placeholder="Middle Name"
                    id="mname"
                    name="mname"
                    style="width: 32.5%; display: inline-block"
                  />
                  <input
                    type="text"
                    placeholder="Last Name"
                    id="lname"
                    name="lname"
                    style="width: 32.5%; display: inline-block"
                  />
                  <p id="nameError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="email" class="col-md-12 mb-3"
                    ><i class="fas fa-envelope"></i> Email</label
                  >
                  <input type="email" id="email" name="email" />
                  <p id="emailError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="contactnumber" class="col-md-12 mb-3"
                    ><i class="fas fa-phone-alt"></i> Contact No</label
                  >
                  <input type="text" id="contactnumber" name="contactnumber" />
                  <p id="contactnumberError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="faculty" class="col-md-12 mb-3"
                    ><i class="fas fa-city"></i> Faculty</label
                  >
                  <select id="faculty" name="faculty">
                    <option value="">Select Faculty</option>
                    <option
                      th:each="faculty : ${faculties}"
                      th:if="${faculty.active}"
                      th:value="${faculty.facultyid}"
                      th:text="${faculty.faculty}"
                    ></option>
                  </select>
                  <input type="hidden" id="facultyid" name="facultyid" />
                  <p id="facultyError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="department" class="col-md-12 mb-3"
                    ><i class="fas fa-building"></i> Department</label
                  >
                  <select id="department" name="department" disabled>
                    <option value="">Select Faculty first</option>
                  </select>
                  <input type="hidden" id="departmentid" name="departmentid" />
                  <p id="departmentError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="program" class="col-md-12 mb-3"
                    ><i class="fas fa-graduation-cap"></i> Program</label
                  >
                  <select id="program" name="program" disabled>
                    <option value="">Select Department first</option>
                  </select>
                  <input type="hidden" id="programid" name="programid" />
                  <p id="programError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="semester" class="col-md-12 mb-3"
                    ><i class="fa fa-book"></i> Semester</label
                  >
                  <select id="semester" name="semester" disabled>
                    <option value="">Select Program first</option>
                  </select>
                  <input type="hidden" id="semesterid" name="semesterid" />
                  <p id="semesterError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <div
                    class="custom-checkbox"
                    style="
                      margin: auto;
                      justify-content: right;
                      align-items: center;
                      display: flex;
                    "
                  >
                    <input type="checkbox" id="active" name="active" checked />
                    <label for="active" class="checkbox-icon"></label>
                    <label for="active" style="font-size: 16px">Active</label>
                  </div>
                </div>
                <input
                  type="hidden"
                  name="createdBy"
                  id="createdBy"
                  th:value="${userDetails.adminid}"
                />
                <input
                  type="hidden"
                  name="modifiedBy"
                  id="modifiedBy"
                  th:value="${userDetails.adminid}"
                />
                <div class="form-group mt-3">
                  <button type="submit" class="btn-submit">Add Student</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="editstudentModal" tabindex="-1">
      <div class="modal-dialog modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Student</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            >
              <i class="fa fa-times"></i>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-container">
              <form
                id="editeditsubjectForm"
                th:action="@{/updateStudent}"
                method="post"
                onsubmit="return validateForm('edit')"
              >
                <input type="hidden" id="editstudentid" name="studentid" />

                <div class="form-group">
                  <label for="editentrollmentno" class="col-md-12 mb-3"
                    ><i class="fa fa-fax"></i>Enrollment No</label
                  >
                  <input
                    type="text"
                    id="editentrollmentno"
                    name="entrollmentno"
                  />
                  <p id="editentrollmentnoError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="editname" class="col-md-12 mb-3"
                    ><i class="fas fa-user"></i> Name</label
                  >
                  <input
                    type="text"
                    placeholder="First Name"
                    id="editfname"
                    name="fname"
                    style="width: 32.5%; display: inline-block"
                  />
                  <input
                    type="text"
                    placeholder="Middle Name"
                    id="editmname"
                    name="mname"
                    style="width: 32.5%; display: inline-block"
                  />
                  <input
                    type="text"
                    placeholder="Last Name"
                    id="editlname"
                    name="lname"
                    style="width: 32.5%; display: inline-block"
                  />
                  <p id="editnameError" class="error-message"></p>
                </div>

                <div class="form-group">
                  <label for="editemail" class="col-md-12 mb-3"
                    ><i class="fas fa-envelope"></i>Email</label
                  >
                  <input type="email" id="editemail" name="email" />
                  <p id="editemailError" class="error-message"></p>
                </div>

                <div class="form-group">
                  <label for="editcontactnumber" class="col-md-12 mb-3"
                    ><i class="fas fa-phone-alt"></i>Contact No</label
                  >
                  <input
                    type="text"
                    id="editcontactnumber"
                    name="contactnumber"
                  />
                  <p id="editcontactnumberError" class="error-message"></p>
                </div>
                <div class="form-group">
                  <label for="editfacultyName" class="col-md-12 mb-3"
                    ><i class="fas fa-city"></i> Faculty</label
                  >
                  <select
                    id="editfacultyName"
                    name="faculty"
                    onchange="loadDepartments(loadPrograms)"
                  >
                    <option value="">Select Faculty</option>
                    <option
                      th:each="faculty : ${faculties}"
                      th:if="${faculty.active}"
                      th:value="${faculty.facultyid}"
                      th:text="${faculty.faculty}"
                    ></option>
                  </select>
                  <input type="hidden" id="facultyid" name="facultyid" />
                  <p id="editfacultyError" class="error-message"></p>
                </div>

                <div class="form-group">
                  <label for="editdepartmentName" class="col-md-12 mb-3"
                    ><i class="fas fa-building"></i> Department</label
                  >
                  <select
                    id="editdepartmentName"
                    name="department"
                    onchange="loadPrograms(loadSemesters)"
                  >
                    <option value="">Select Department</option>
                  </select>
                  <input type="hidden" id="departmentid" name="departmentid" />
                  <p id="editdepartmentError" class="error-message"></p>
                </div>

                <div class="form-group">
                  <label for="editprogramName" class="col-md-12 mb-3"
                    ><i class="fas fa-graduation-cap"></i> Program</label
                  >
                  <select
                    id="editprogramName"
                    name="program"
                    onchange="loadSemesters()"
                  >
                    <option value="">Select Program</option>
                  </select>
                  <input type="hidden" id="programid" name="programid" />
                  <p id="editprogramError" class="error-message"></p>
                </div>

                <div class="form-group">
                  <label for="editsemesterName" class="col-md-12 mb-3"
                    ><i class="fa fa-book"></i> Semester</label
                  >
                  <select id="editsemesterName" name="semester">
                    <option value="">Select Semester</option>
                  </select>
                  <input type="hidden" id="semesterid" name="semesterid" />
                  <p id="editsemesterError" class="error-message"></p>
                </div>

                <div class="form-group">
                  <div
                    class="custom-checkbox"
                    style="
                      margin: auto;
                      justify-content: right;
                      align-items: center;
                      display: flex;
                    "
                  >
                    <input
                      type="checkbox"
                      id="editsubjectActive"
                      name="active"
                      value="true"
                      checked
                    />
                    <label
                      for="editsubjectActive"
                      class="checkbox-icon"
                    ></label>
                    <label for="editsubjectActive" style="font-size: 16px"
                      >Active</label
                    >
                  </div>
                </div>
                <input
                  type="hidden"
                  name="modifiedBy"
                  id="modifiedBy"
                  th:value="${userDetails.adminid}"
                />
                <div class="form-group mt-3">
                  <button type="submit" class="btn-submit">Edit Student</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="deletestudentModal" tabindex="-1">
      <div class="modal-dialog modal-confirm">
        <div class="modal-content">
          <div class="modal-header flex-column">
            <h4>Are you sure?</h4>
          </div>
          <div class="modal-body">
            <p>
              Do you really want to delete these Student Data?<br />
              This process cannot be undone.
            </p>
          </div>
          <div class="modal-footer justify-content-center">
            <form
              id="deletestudentForm"
              th:action="@{/deleteStudents}"
              method="post"
            >
              <input type="hidden" id="deletestudentid" name="studentid" />
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancel
              </button>
              <button
                type="button"
                class="btn btn-danger"
                onclick="deleteStudent()"
              >
                Delete
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function () {
        $("#faculty").change(function () {
          var facultyId = $(this).val();
          var departmentDropdown = $("#department");

          if (facultyId) {
            $.ajax({
              type: "GET",
              url: "/api/departments/" + facultyId,
              success: function (data) {
                departmentDropdown.empty();
                departmentDropdown.append(
                  '<option value="">Select Department</option>'
                );
                $.each(data, function (index, department) {
                  departmentDropdown.append(
                    '<option value="' +
                      department.departmentid +
                      '">' +
                      department.department +
                      "</option>"
                  );
                });
                departmentDropdown.prop("disabled", false);
                $("#program")
                  .prop("disabled", true)
                  .empty()
                  .append('<option value="">Select Department first</option>');
                $("#semester")
                  .prop("disabled", true)
                  .empty()
                  .append('<option value="">Select Program first</option>');
              },
              error: function () {
                console.error("Error fetching departments");
              },
            });
          } else {
            departmentDropdown
              .empty()
              .append('<option value="">Select Faculty first</option>');
            departmentDropdown.prop("disabled", true);
            $("#program")
              .prop("disabled", true)
              .empty()
              .append('<option value="">Select Department first</option>');
            $("#semester")
              .prop("disabled", true)
              .empty()
              .append('<option value="">Select Program first</option>');
          }
        });

        $("#department").change(function () {
          var departmentId = $(this).val();
          var programDropdown = $("#program");

          if (departmentId) {
            $.ajax({
              type: "GET",
              url: "/api/programs/" + departmentId,
              success: function (data) {
                programDropdown.empty();
                programDropdown.append(
                  '<option value="">Select Program</option>'
                );
                $.each(data, function (index, program) {
                  programDropdown.append(
                    '<option value="' +
                      program.programid +
                      '">' +
                      program.program +
                      "</option>"
                  );
                });
                programDropdown.prop("disabled", false);
                $("#semester")
                  .prop("disabled", true)
                  .empty()
                  .append('<option value="">Select Program first</option>');
              },
              error: function () {
                console.error("Error fetching programs");
              },
            });
          } else {
            programDropdown
              .empty()
              .append('<option value="">Select Department first</option>');
            programDropdown.prop("disabled", true);
            $("#semester")
              .prop("disabled", true)
              .empty()
              .append('<option value="">Select Program first</option>');
          }
        });

        $(document).ready(function () {
          $("#program").change(function () {
            var programId = $(this).val();
            var semesterDropdown = $("#semester");

            if (programId) {
              $.ajax({
                type: "GET",
                url: "/api/semesters",
                success: function (data) {
                  semesterDropdown.empty();
                  semesterDropdown.append(
                    '<option value="">Select Semester</option>'
                  );
                  $.each(data, function (index, semester) {
                    semesterDropdown.append(
                      '<option value="' +
                        semester.semesterid +
                        '">' +
                        semester.semester +
                        "</option>"
                    );
                  });
                  semesterDropdown.prop("disabled", false);
                },
                error: function () {
                  console.error("Error fetching semesters");
                },
              });
            } else {
              semesterDropdown
                .empty()
                .append('<option value="">Select Program first</option>');
              semesterDropdown.prop("disabled", true);
            }
          });
        });
      });

      function loadDepartments(selectedDepartmentId, callback) {
        var facultyId = $("#editfacultyName").val();
        if (facultyId) {
          $.ajax({
            url: "/api/departments/" + facultyId,
            type: "GET",
            data: { facultyId: facultyId },
            success: function (data) {
              var departmentSelect = $("#editdepartmentName");
              departmentSelect.empty();
              departmentSelect.append(
                '<option value="">Select Department</option>'
              );
              $.each(data, function (index, department) {
                departmentSelect.append(
                  '<option value="' +
                    department.departmentid +
                    '">' +
                    department.department +
                    "</option>"
                );
              });
              if (selectedDepartmentId) {
                departmentSelect.val(selectedDepartmentId);
              }
              if (callback) callback();
            },
            error: function () {
              alert("Error loading departments");
            },
          });
        } else {
          $("#editdepartmentName")
            .empty()
            .append('<option value="">Select Department</option>');
        }
      }

      function loadPrograms(selectedProgramId, callback) {
        var departmentId = $("#editdepartmentName").val();
        if (departmentId) {
          $.ajax({
            url: "/api/programs/" + departmentId,
            type: "GET",
            data: { departmentId: departmentId },
            success: function (data) {
              var programSelect = $("#editprogramName");
              programSelect.empty();
              programSelect.append('<option value="">Select Program</option>');
              $.each(data, function (index, program) {
                programSelect.append(
                  '<option value="' +
                    program.programid +
                    '">' +
                    program.program +
                    "</option>"
                );
              });
              if (selectedProgramId) {
                programSelect.val(selectedProgramId);
              }
              if (callback) callback();
            },
            error: function () {
              alert("Error loading programs");
            },
          });
        } else {
          $("#editprogramName")
            .empty()
            .append('<option value="">Select Program</option>');
        }
      }

      function loadSemesters(selectedSemesterId, callback) {
        var programId = $("#editprogramName").val();
        if (programId) {
          $.ajax({
            url: "/api/semesters",
            type: "GET",
            data: { programId: programId },
            success: function (data) {
              var semesterSelect = $("#editsemesterName");
              semesterSelect.empty();
              semesterSelect.append(
                '<option value="">Select Semester</option>'
              );
              $.each(data, function (index, semester) {
                semesterSelect.append(
                  '<option value="' +
                    semester.semesterid +
                    '">' +
                    semester.semester +
                    "</option>"
                );
              });
              if (selectedSemesterId) {
                semesterSelect.val(selectedSemesterId);
              }
              if (callback) callback();
            },
            error: function () {
              alert("Error loading semesters");
            },
          });
        } else {
          $("#editsemesterName")
            .empty()
            .append('<option value="">Select Semester</option>');
        }
      }
    </script>

    <script>
      function validateEnrollmentNo(type) {
        const registrationId = document.getElementById(
          type === "add" ? "entrollmentno" : "editentrollmentno"
        ).value;
        const errorElement = document.getElementById(
          type === "add" ? "entrollmentnoError" : "editentrollmentnoError"
        );
        if (registrationId.length < 1 || registrationId.length > 255) {
          errorElement.textContent = "Please enter a valid Teacher ID";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateName(type) {
        const fname = document.getElementById(
          type === "add" ? "fname" : "editfname"
        ).value;
        const mname = document.getElementById(
          type === "add" ? "mname" : "editmname"
        ).value;
        const lname = document.getElementById(
          type === "add" ? "lname" : "editlname"
        ).value;
        const errorElement = document.getElementById(
          type === "add" ? "nameError" : "editnameError"
        );

        if (
          fname.length < 2 ||
          fname.length > 255 ||
          mname.length < 2 ||
          mname.length > 255 ||
          lname.length < 2 ||
          lname.length > 255
        ) {
          errorElement.textContent = "Please enter a valid name";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateEmail(type) {
        const email = document.getElementById(
          type === "add" ? "email" : "editemail"
        ).value;
        const errorElement = document.getElementById(
          type === "add" ? "emailError" : "editemailError"
        );
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        if (!emailRegex.test(email)) {
          errorElement.textContent = "Please enter a valid email";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateContactNo(type) {
        const contactnumber = document.getElementById(
          type === "add" ? "contactnumber" : "editcontactnumber"
        ).value;
        const errorElement = document.getElementById(
          type === "add" ? "contactnumberError" : "editcontactnumberError"
        );
        const phoneRegex = /^[0-9]{10}$/;

        if (!phoneRegex.test(contactnumber)) {
          errorElement.textContent = "Please enter a valid contact number";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateFacultyDropdown(type) {
        const dropdown = document.getElementById(
          type === "add" ? "faculty" : "editfacultyName"
        );
        const errorElement = document.getElementById(
          type === "add" ? "facultyError" : "editfacultyError"
        );

        if (dropdown.value === "") {
          errorElement.textContent = "Please select a faculty";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateDepartmentDropdown(type) {
        const dropdown = document.getElementById(
          type === "add" ? "department" : "editdepartmentName"
        );
        const errorElement = document.getElementById(
          type === "add" ? "departmentError" : "editdepartmentError"
        );

        if (dropdown.value === "") {
          errorElement.textContent = "Please select a department";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateProgramDropdown(type) {
        const dropdown = document.getElementById(
          type === "add" ? "program" : "editprogramName"
        );
        const errorElement = document.getElementById(
          type === "add" ? "programError" : "editprogramError"
        );

        if (dropdown.value === "") {
          errorElement.textContent = "Please select a program";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateSemesterDropdown(type) {
        const dropdown = document.getElementById(
          type === "add" ? "semester" : "editsemesterName"
        );
        const errorElement = document.getElementById(
          type === "add" ? "semesterError" : "editsemesterError"
        );

        if (dropdown.value === "") {
          errorElement.textContent = "Please select a semester";
          return false;
        } else {
          errorElement.textContent = "";
          return true;
        }
      }

      function validateForm(type) {
        const isValidEnrollmentNo = validateEnrollmentNo(type);
        const isValidName = validateName(type);
        const isValidEmail = validateEmail(type);
        const isValidContactNo = validateContactNo(type);
        const isValidFacultyDropdown = validateFacultyDropdown(type);
        const isValidDepartmentDropdown = validateDepartmentDropdown(type);
        const isValidProgramDropdown = validateProgramDropdown(type);
        const isValidSemesterDropdown = validateSemesterDropdown(type);

        return (
          isValidEnrollmentNo &&
          isValidName &&
          isValidEmail &&
          isValidContactNo &&
          isValidFacultyDropdown &&
          isValidDepartmentDropdown &&
          isValidProgramDropdown &&
          isValidSemesterDropdown
        );
      }

      document
        .getElementById("faculty")
        .addEventListener("change", function () {
          var selectedFacultyId = this.value;
          document.getElementById("facultyid").value = selectedFacultyId;
        });
      document
        .getElementById("department")
        .addEventListener("change", function () {
          var selectedDepartmentId = this.value;
          document.getElementById("departmentid").value = selectedDepartmentId;
        });
      document
        .getElementById("program")
        .addEventListener("change", function () {
          var selectedProgramId = this.value;
          document.getElementById("programid").value = selectedProgramId;
        });
      document
        .getElementById("semester")
        .addEventListener("change", function () {
          var selectedSemesterId = this.value;
          document.getElementById("semesterid").value = selectedSemesterId;
        });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var entrollmentnoInput = document.getElementById("entrollmentno");
        var entrollmentnoError = document.getElementById("entrollmentnoError");

        entrollmentnoInput.addEventListener("input", function () {
          var value = entrollmentnoInput.value;

          if (!/^\d*$/.test(value)) {
            entrollmentnoError.textContent =
              "Enrollment No must contain only numbers.";
            entrollmentnoInput.classList.add("input-error");
          } else {
            entrollmentnoError.textContent = "";
            entrollmentnoInput.classList.remove("input-error");
          }
        });

        entrollmentnoInput.addEventListener("input", function () {
          var entrollmentno = entrollmentnoInput.value;
          var tableRows = document.querySelectorAll(".table-custom tbody tr");
          var found = false;

          tableRows.forEach(function (row) {
            if (
              row.querySelector("td:nth-child(1)").textContent.trim() ===
              entrollmentno
            ) {
              found = true;
              var nameParts = row
                .querySelector("td:nth-child(2)")
                .textContent.trim()
                .split(" ");
              var fname = nameParts[0] || "";
              var mname = nameParts[1] || "";
              var lname = nameParts[2] || "";
              var email = row
                .querySelector("td:nth-child(3)")
                .textContent.trim();
              var contactnumber = row
                .querySelector("td:nth-child(4)")
                .textContent.trim();
              var facultyId = row
                .querySelector("td:nth-child(5)")
                .getAttribute("data-facultyid");
              var departmentId = row
                .querySelector("td:nth-child(6)")
                .getAttribute("data-departmentid");
              var programId = row
                .querySelector("td:nth-child(7)")
                .getAttribute("data-programid");
              var semesterId = row
                .querySelector("td:nth-child(8)")
                .getAttribute("data-semesterid");

              document.getElementById("fname").value = fname;
              document.getElementById("mname").value = mname;
              document.getElementById("lname").value = lname;
              document.getElementById("email").value = email;
              document.getElementById("contactnumber").value = contactnumber;
              document.getElementById("faculty").value = facultyId;

              loadDepartment(facultyId, departmentId, programId, semesterId);

              card.style.display = "block";
            }
          });

          if (!found) {
            card.style.display = "none";
          }
        });

        function loadDepartment(
          facultyId,
          selectedDepartmentId,
          selectedProgramId,
          selectedSemesterId
        ) {
          if (facultyId) {
            $.ajax({
              url: "/api/departments/" + facultyId,
              type: "GET",
              success: function (data) {
                var departmentSelect = document.getElementById("department");
                departmentSelect.innerHTML =
                  '<option value="">Select Department</option>';
                data.forEach(function (department) {
                  var option = document.createElement("option");
                  option.value = department.departmentid;
                  option.textContent = department.department;
                  departmentSelect.appendChild(option);
                });
                if (selectedDepartmentId) {
                  departmentSelect.value = selectedDepartmentId;
                  loadProgram(
                    selectedDepartmentId,
                    selectedProgramId,
                    selectedSemesterId
                  );
                }
                departmentSelect.disabled = false;
              },
              error: function () {
                alert("Error loading departments");
              },
            });
          } else {
            var departmentSelect = document.getElementById("department");
            departmentSelect.innerHTML =
              '<option value="">Select Department</option>';
            departmentSelect.disabled = true;
          }
        }

        function loadProgram(
          departmentId,
          selectedProgramId,
          selectedSemesterId
        ) {
          if (departmentId) {
            $.ajax({
              url: "/api/programs/" + departmentId,
              type: "GET",
              success: function (data) {
                var programSelect = document.getElementById("program");
                programSelect.innerHTML =
                  '<option value="">Select Program</option>';
                data.forEach(function (program) {
                  var option = document.createElement("option");
                  option.value = program.programid;
                  option.textContent = program.program;
                  programSelect.appendChild(option);
                });
                if (selectedProgramId) {
                  programSelect.value = selectedProgramId;
                  loadSemester(selectedProgramId, selectedSemesterId);
                }
                programSelect.disabled = false;
              },
              error: function () {
                alert("Error loading programs");
              },
            });
          } else {
            var programSelect = document.getElementById("program");
            programSelect.innerHTML =
              '<option value="">Select Program</option>';
            programSelect.disabled = true;
          }
        }

        function loadSemester(programId, selectedSemesterId) {
          if (programId) {
            $.ajax({
              url: "/api/semesters",
              type: "GET",
              success: function (data) {
                var semesterSelect = document.getElementById("semester");
                semesterSelect.innerHTML =
                  '<option value="">Select Semester</option>';
                data.forEach(function (semester) {
                  var option = document.createElement("option");
                  option.value = semester.semesterid;
                  option.textContent = semester.semester;
                  semesterSelect.appendChild(option);
                });
                if (selectedSemesterId) {
                  semesterSelect.value = selectedSemesterId;
                }
                semesterSelect.disabled = false;
              },
              error: function () {
                alert("Error loading semesters");
              },
            });
          } else {
            var semesterSelect = document.getElementById("semester");
            semesterSelect.innerHTML =
              '<option value="">Select Semester</option>';
            semesterSelect.disabled = true;
          }
        }
      });
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var editstudentModal = document.getElementById("editstudentModal");

        editstudentModal.addEventListener("show.bs.modal", function (event) {
          var button = event.relatedTarget;
          var editstudentid = button.getAttribute("data-studentid");
          var editeditstudentid = document.getElementById("editstudentid");
          editeditstudentid.value = editstudentid;

          var row = button.closest("tr");
          var enrollmentno = row
            .querySelector("td:nth-child(1)")
            .textContent.trim();
          var nameParts = row
            .querySelector("td:nth-child(2)")
            .textContent.trim()
            .split(" ");
          var firstName = nameParts[0];
          var middleName = nameParts[1];
          var lastName = nameParts[2];
          var email = row.querySelector("td:nth-child(3)").textContent.trim();
          var contactnumber = row
            .querySelector("td:nth-child(4)")
            .textContent.trim();
          var facultyId = row
            .querySelector("td:nth-child(5)")
            .getAttribute("data-facultyid");
          var departmentId = row
            .querySelector("td:nth-child(6)")
            .getAttribute("data-departmentid");
          var programId = row
            .querySelector("td:nth-child(7)")
            .getAttribute("data-programid");
          var semesterId = row
            .querySelector("td:nth-child(8)")
            .getAttribute("data-semesterid");

          document.getElementById("editentrollmentno").value = enrollmentno;
          document.getElementById("editfname").value = firstName;
          document.getElementById("editmname").value = middleName;
          document.getElementById("editlname").value = lastName;
          document.getElementById("editemail").value = email;
          document.getElementById("editcontactnumber").value = contactnumber;
          document.getElementById("editfacultyName").value = facultyId;

          loadDepartments(departmentId, function () {
            document.getElementById("editdepartmentName").value = departmentId;

            loadPrograms(programId, function () {
              document.getElementById("editprogramName").value = programId;

              loadSemesters(semesterId, function () {
                document.getElementById("editsemesterName").value = semesterId;
              });
            });
          });

          var editActiveCheckbox = document.getElementById("editsubjectActive");
          editActiveCheckbox.checked =
            row.querySelector(".badge-success") !== null;
        });

        var deletestudentModal = document.getElementById("deletestudentModal");
        deletestudentModal.addEventListener("show.bs.modal", function (event) {
          var button = event.relatedTarget;
          var studentid = button.getAttribute("data-studentid");
          var deletestudentid = document.getElementById("deletestudentid");
          deletestudentid.value = studentid;
        });
      });

      function deleteStudent() {
        document.getElementById("deletestudentForm").submit();
      }
    </script>

    <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/chart.js/chart.umd.js"></script>
    <script src="assets/vendor/echarts/echarts.min.js"></script>
    <script src="assets/vendor/quill/quill.js"></script>
    <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
    <script src="assets/vendor/tinymce/tinymce.min.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <script src="assets/js/main.js"></script>
  </body>
</html>
